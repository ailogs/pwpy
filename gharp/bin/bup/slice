#!/bin/tcsh
# MATH alias
alias MATH 'set \!:1 = `echo "\!:3-$" | bc -l`'
#

if ($#argv < 3) then
        echo "Must give a "cald" gps-dataset, start time, and num-iters"
        exit(0)
endif

set n = 0
set vis = $1
set hour = $2
set maxiters = $3
set oldhour = $hour
set outfile = GPS
while ($n < $maxiters)
	MATH hour = ( $hour + 0.002777777778 )
	set t1=`atahourstohhmmss $oldhour`
	set t2=`atahourstohhmmss $hour`
	set hr=`awk 'BEGIN { print substr("'"$t1"'", 1,2) }'`
	set min=`awk 'BEGIN { print substr("'"$t1"'", 4,2) }'`
	set sec=`awk 'BEGIN { print substr("'"$t1"'", 7,2) }'`
	set time=$hr-$min-$sec

	rm -r $outfile $outfile.bm $outfile.mp $outfile.cl $outfile.cm >& junk
	echo uvcat vis=$vis select="time($t1,$t2)" out=$outfile
	uvcat vis=$vis select="time($t1,$t2)" out=$outfile

	# imaging script does clean and cgplot steps, outputs files
	if (-e $outfile/visdata) then
		imaging $outfile
		mv $outfile.png $outfile$time.png
	endif

	@ n += 1
	set oldhour = $hour
end

